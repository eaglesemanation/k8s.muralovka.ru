---
- hosts: k3s
  roles:
    - xanmanning.k3s

- hosts: nfs_servers
  become: true
  roles:
    - geerlingguy.nfs
  pre_tasks:
    - name: Ensure that share path exists
      import_tasks: tasks/ensure_nfs_share.yaml

- hosts: localhost
  handlers:
    - import_tasks: handlers/main.yaml
  tasks:
    - name: Add dev cluster context to local kubecfg
      import_tasks: tasks/merge_k8s_context.yaml

    - name: Deploy FluxCD
      import_tasks: tasks/bootstrap_flux.yaml
