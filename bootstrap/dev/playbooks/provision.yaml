---
- hosts: k3s
  roles:
    - xanmanning.k3s

- hosts: smb_servers
  become: true
  handlers:
    - import_tasks: handlers/smb_servers.yaml
  tasks:
    - name: Setup samba share
      import_tasks: tasks/setup_samba.yaml

- hosts: localhost
  handlers:
    - import_tasks: handlers/localhost.yaml
  tasks:
    - name: Add dev cluster context to local kubecfg
      import_tasks: tasks/merge_k8s_context.yaml

    - name: Deploy FluxCD
      import_tasks: tasks/bootstrap_flux.yaml
